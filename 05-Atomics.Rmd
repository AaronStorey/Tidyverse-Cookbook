```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE
)
```
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE
)
```
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE
)
```
# Atomics

## Strings

### Basic string operations

1. **Task:** Paste/concatenate strings.

    __<span style="color:blue">TDVS:</span>__
    
    ```{r, eval = TRUE}
    stringr::str_c("a", "b", NA, NaN, NULL, factor("lalala"), character(0))
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    paste("a", "b", NA, NaN, NULL, factor("lalala"), character(0), sep = "")
    ```
    
1. **Task:** Count the number of letters in a string.

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_length(c("four", NA, NaN, NULL, factor("lalala")))
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    nchar(c("four", NA, NaN, NULL, factor("lalala")))
    ```

1. **Task:** Return the last letter of a string, subset a string.

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_sub(c("five", "six"), -1)
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    substr(c("five", "six"), start = nchar(c("five", "six")), stop = nchar(c("five", "six")))
    ```
    
1. **Task:** Repeat/duplicate a string several times.

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_dup("_a_", 5)
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    paste(rep("_a_", 5), collapse = "")
    ```
    
1. **Task:** Remove/trim spaces at the beginning (leading) and/or end (trailing) of a string.

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_trim(c("  2left_1right ", "   "), side = c("left"))
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    # ^\\s+|\\s+$ is the regex for one or more spaces in the beginning
    # or one or more spaces at the end
    gsub("^\\s+", "", c("  2left_1right ", "   "))
    ```
    
1. **Task:** Fill/pad spaces (or other characters) before and/or after a string. 

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_pad(c("lalala", ""), width = 7)
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    unname(
      vapply(c("lalala", ""), 
             function(x) if(nchar(x) < 7) {
               paste0(rep(" ", 7 - nchar(x)), x, collapse = "")
               } else {x},
             character(1)
             )
      )
    ```

### Pattern matching

1. **Task:** Does a string contain a specific sequence of characters? 

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_detect(c("my number is 110", "call 911"), "\\d{3}")
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    grepl("\\d{3}", c("my number is 110", "call 911"))
    ```
   
1. **Task:** Return every string that contains a specific sequence of characters? 

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_subset(c("my number is 110", "call 911"), "\\d{3}")
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    grep("\\d{3}", c("my number is 110", "call 911"), value = TRUE)
    ```

1. **Task:** Return the (first) start and end index of substrings within a string? 

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    # use stringr::str_locate_all to get a matrix of all start and end indexes
    stringr::str_locate(c("my 112 number is 110", "call 911"), c("\\d{3}"))
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    # Use gregexpr to construct something similar to str_locate_all
    
    matches <- regexpr("\\d{3}", c("my 112 number is 110", "call 911"))
    
    # formatting
    match_lengths <- attr(matches, "match.length")
    attributes(matches) <- NULL
    match_indices <- matrix(c(matches, matches + match_lengths - 1), ncol = 2)
    colnames(match_indices) <- c("start", "end")
    
    # output
    match_indices
    ```

1. **Task:** Return the (first) matched substring within a string? 

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    # use stringr::str_extract_all to get a matrix of all matched substrings
    stringr::str_extract(c("my 112 number is 110", "call 911"), c("\\d{3}"))
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    # combine `substr()` with match_indices from above
    ```

1. **Task:** Return the matching strings and matched capture groups. 

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    # the example from the stringr vignette
    strings <- c(
      "apple",
      "219 733 8965", 
      "329-293-8753", 
      "Work: 579-499-7527; Home: 543.355.3679"
      )
    phone <- "([2-9][0-9]{2})[- .]([0-9]{3})[- .]([0-9]{4})"
    
    stringr::str_match(strings, phone)
    # Use stringr::str_match_all for list return
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    # `regmatches()`
    ```
    
1. **Task:** Replace/substitute the first matching subtstring within a string.

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_replace(c("my 112 number is 110", "call 911"), c("\\d{1}(\\d{2})"), "\\1\\1")
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    sub(c("\\d{1}(\\d{2})"), "\\1\\1", c("my 112 number is 110", "call 911"))
    ```
    
1. **Task:** Replace/substitute all matching subtstrings within a string.

    __<span style="color:blue">TDVS:</span>__
    ```{r, eval = TRUE}
    stringr::str_replace_all(c("my 112 number is 110", "call 911"), c("\\d{1}(\\d{2})"), "\\1\\1")
    ```

    __<span style="color:green">BASE:</span>__
    ```{r, eval = TRUE}
    gsub(c("\\d{1}(\\d{2})"), "\\1\\1", c("my 112 number is 110", "call 911"))
    ```    
    
## Factors

**Task:** Reorder the levels of a factor by another variable.

**Task:** Reverse the order of factor levels.

**Task:** Change specific levels of a factor by name, while preserving the order.

**Task:** Move specific factor levels in front of all others.

**Task:** Join/bind/combine/compose/unite rare factor levels into one.

**Task:** Join/bind/combine/compose/unite common factor levels into one.

## Dates and times

**Task:** Convert a string into a date.

**Task:** Add days (as an integer) to a date.

**Task:** Generate a (dense) sequence of days/years/months.

## Resources

* [stringr vignette](https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html)
* [forcats 0.1 on RStudio blog](https://blog.rstudio.org/2016/08/31/forcats-0-1-0/)
* [lubridate vignette](https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html)
